---
# tasks file for sample-role_nginx-ubuntu â€” main entrypoint for the role
- name: Ensure apt cache is up-to-date (Debian/Ubuntu)
  ansible.builtin.apt:
    update_cache: yes
  when: ansible_facts['os_family'] == 'Debian'
  tags: always

- name: Install nginx package
  ansible.builtin.package:
    name: "{{ nginx_package }}"
    state: present
  notify: "reload nginx"
  tags: install

- name: Ensure nginx root directory exists
  ansible.builtin.file:
    path: "{{ nginx_root }}"
    state: directory
    owner: www-data
    group: www-data
    mode: '0755'
  tags: config

- name: Deploy index.html (static test page)
  ansible.builtin.copy:
    src: "{{ nginx_index_file }}"
    dest: "{{ nginx_root }}/index.html"
    owner: www-data
    group: www-data
    mode: '0644'
  tags: config

- name: Deploy nginx site configuration
  ansible.builtin.template:
    src: "{{ nginx_site_template }}"
    dest: "{{ nginx_sites_available }}/default"
    owner: root
    group: root
    mode: '0644'
  notify: "reload nginx"
  tags: config

- name: Ensure sites-enabled symlink exists
  ansible.builtin.file:
    src: "{{ nginx_sites_available }}/default"
    dest: "{{ nginx_sites_enabled }}/default"
    state: link
  notify: "reload nginx"
  tags: config

- name: Ensure nginx service is started and enabled
  ansible.builtin.service:
    name: "{{ nginx_service_name }}"
    state: started
    enabled: true
  tags: service
